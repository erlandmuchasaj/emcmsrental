function InfoBox(opt_opts){opt_opts=opt_opts||{};google.maps.OverlayView.apply(this,arguments);this.content_=opt_opts.content||"";this.disableAutoPan_=opt_opts.disableAutoPan||false;this.maxWidth_=opt_opts.maxWidth||0;this.pixelOffset_=opt_opts.pixelOffset||new google.maps.Size(0,0);this.position_=opt_opts.position||new google.maps.LatLng(0,0);this.zIndex_=opt_opts.zIndex||null;this.boxStyle_=opt_opts.boxStyle||{};this.closeBoxMargin_=opt_opts.closeBoxMargin||"2px";this.closeBoxURL_=opt_opts.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif";if(opt_opts.closeBoxURL===""){this.closeBoxURL_="";}this.infoBoxClearance_=opt_opts.infoBoxClearance||new google.maps.Size(1,1);this.isHidden_=opt_opts.isHidden||false;this.pane_=opt_opts.pane||"floatPane";this.div_=null;this.closeListener_=null;this.fixedWidthSet_=null;}InfoBox.prototype=new google.maps.OverlayView();InfoBox.prototype.createInfoBoxDiv_=function(){var bw;if(!this.div_){this.div_=document.createElement("div");this.setBoxStyle_();this.div_.style.position="absolute";this.div_.style.visibility='hidden';if(this.zIndex_!==null){this.div_.style.zIndex=this.zIndex_;}this.div_.innerHTML=this.getCloseBoxImg_()+this.content_;this.getPanes()[this.pane_].appendChild(this.div_);this.addClickHandler_();if(this.div_.style.width){this.fixedWidthSet_=true;}else{if(this.maxWidth_!==0&&this.div_.offsetWidth>this.maxWidth_){this.div_.style.width=this.maxWidth_;this.div_.style.overflow="auto";this.fixedWidthSet_=true;}else{bw=this.getBoxWidths_();this.div_.style.width=(this.div_.offsetWidth-bw.left-bw.right)+"px";this.fixedWidthSet_=false;}}this.panBox_(this.disableAutoPan_);google.maps.event.trigger(this,"domready");}};InfoBox.prototype.getCloseBoxImg_=function(){var img="";if(this.closeBoxURL_!==""){img="<img";img+=" src='"+this.closeBoxURL_+"'";img+=" align=right";img+=" style='";img+=" position: relative;";img+=" cursor: pointer;";img+=" margin: "+this.closeBoxMargin_+";";img+="'>";}return img;};InfoBox.prototype.addClickHandler_=function(){var closeBox;if(this.closeBoxURL_!==""){closeBox=this.div_.firstChild;this.closeListener_=google.maps.event.addDomListener(closeBox,'click',this.getCloseClickHandler_());}else{this.closeListener_=null;}};InfoBox.prototype.getCloseClickHandler_=function(){var me=this;return function(){me.close();google.maps.event.trigger(me,"closeclick");};};InfoBox.prototype.panBox_=function(disablePan){if(!disablePan){var map=this.getMap();var bounds=map.getBounds();var mapDiv=map.getDiv();var mapWidth=mapDiv.offsetWidth;var mapHeight=mapDiv.offsetHeight;var boundsSpan=bounds.toSpan();var longSpan=boundsSpan.lng();var latSpan=boundsSpan.lat();var degPixelX=longSpan/mapWidth;var degPixelY=latSpan/mapHeight;var mapWestLng=bounds.getSouthWest().lng();var mapEastLng=bounds.getNorthEast().lng();var mapNorthLat=bounds.getNorthEast().lat();var mapSouthLat=bounds.getSouthWest().lat();var position=this.position_;var iwOffsetX=this.pixelOffset_.width;var iwOffsetY=this.pixelOffset_.height;var padX=this.infoBoxClearance_.width;var padY=this.infoBoxClearance_.height;var iwWestLng=position.lng()+(iwOffsetX-padX)*degPixelX;var iwEastLng=position.lng()+(iwOffsetX+this.div_.offsetWidth+padX)*degPixelX;var iwNorthLat=position.lat()-(iwOffsetY-padY)*degPixelY;var iwSouthLat=position.lat()-(iwOffsetY+this.div_.offsetHeight+padY)*degPixelY;var shiftLng=(iwWestLng<mapWestLng?mapWestLng-iwWestLng:0)+(iwEastLng>mapEastLng?mapEastLng-iwEastLng:0);var shiftLat=(iwNorthLat>mapNorthLat?mapNorthLat-iwNorthLat:0)+(iwSouthLat<mapSouthLat?mapSouthLat-iwSouthLat:0);if(!(shiftLat===0&&shiftLng===0)){var c=map.getCenter();map.setCenter(new google.maps.LatLng(c.lat()-shiftLat,c.lng()-shiftLng));}}};InfoBox.prototype.setBoxStyle_=function(){var i;var boxStyle=this.boxStyle_;for(i in boxStyle){if(boxStyle.hasOwnProperty(i)){this.div_.style[i]=boxStyle[i];}}if(typeof this.div_.style.opacity!=="undefined"){this.div_.style.filter="alpha(opacity="+(this.div_.style.opacity*100)+")";}};InfoBox.prototype.getBoxWidths_=function(){var computedStyle;var bw={top:0,bottom:0,left:0,right:0};var box=this.div_;if(document.defaultView&&document.defaultView.getComputedStyle){computedStyle=box.ownerDocument.defaultView.getComputedStyle(box,"");if(computedStyle){bw.top=parseInt(computedStyle.borderTopWidth,10)||0;bw.bottom=parseInt(computedStyle.borderBottomWidth,10)||0;bw.left=parseInt(computedStyle.borderLeftWidth,10)||0;bw.right=parseInt(computedStyle.borderRightWidth,10)||0;}}else if(document.documentElement.currentStyle){if(box.currentStyle){bw.top=parseInt(box.currentStyle.borderTopWidth,10)||0;bw.bottom=parseInt(box.currentStyle.borderBottomWidth,10)||0;bw.left=parseInt(box.currentStyle.borderLeftWidth,10)||0;bw.right=parseInt(box.currentStyle.borderRightWidth,10)||0;}}return bw;};InfoBox.prototype.onRemove=function(){if(this.div_){this.div_.parentNode.removeChild(this.div_);this.div_=null;}};InfoBox.prototype.draw=function(){this.createInfoBoxDiv_();var pixPosition=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=(pixPosition.x+this.pixelOffset_.width)+"px";this.div_.style.top=(pixPosition.y+this.pixelOffset_.height-20)+"px";var newPos=(pixPosition.y+this.pixelOffset_.height);jQuery(this.div_).css({opacity:0,visibility:"hidden",top:this.div_.style.top});if(this.isHidden_){jQuery(this.div_).css({opacity:0,visibility:"hidden",top:this.div_.style.top});}else{jQuery(this.div_).css({visibility:"visible"}).animate({opacity:1,top:newPos},200);}};InfoBox.prototype.setOptions=function(opt_opts){if(typeof opt_opts.boxStyle!=="undefined"){this.boxStyle_=opt_opts.boxStyle;this.setBoxStyle_();}if(typeof opt_opts.content!=="undefined"){this.setContent(opt_opts.content);}if(typeof opt_opts.disableAutoPan!=="undefined"){this.disableAutoPan_=opt_opts.disableAutoPan;}if(typeof opt_opts.maxWidth!=="undefined"){this.maxWidth_=opt_opts.maxWidth;}if(typeof opt_opts.pixelOffset!=="undefined"){this.pixelOffset_=opt_opts.pixelOffset;}if(typeof opt_opts.position!=="undefined"){this.setPosition(opt_opts.position);}if(typeof opt_opts.zIndex!=="undefined"){this.setZIndex(opt_opts.zIndex);}if(typeof opt_opts.closeBoxMargin!=="undefined"){this.closeBoxMargin_=opt_opts.closeBoxMargin;}if(typeof opt_opts.closeBoxURL!=="undefined"){this.closeBoxURL_=opt_opts.closeBoxURL;}if(typeof opt_opts.infoBoxClearance!=="undefined"){this.infoBoxClearance_=opt_opts.infoBoxClearance;}if(typeof opt_opts.isHidden!=="undefined"){this.isHidden_=opt_opts.isHidden;}if(this.div_){this.draw();}};InfoBox.prototype.setContent=function(content){this.content_=content;if(this.div_){if(this.closeListener_){google.maps.event.removeListener(this.closeListener_);this.closeListener_=null;}if(!this.fixedWidthSet_){this.div_.style.width="";}this.div_.innerHTML=this.getCloseBoxImg_()+content;if(!this.fixedWidthSet_){this.div_.style.width=this.div_.offsetWidth+"px";this.div_.innerHTML=this.getCloseBoxImg_()+content;}this.addClickHandler_();}google.maps.event.trigger(this,"content_changed");};InfoBox.prototype.setPosition=function(latlng){this.position_=latlng;if(this.div_){this.draw();}google.maps.event.trigger(this,"position_changed");};InfoBox.prototype.setZIndex=function(index){this.zIndex_=index;if(this.div_){this.div_.style.zIndex=index;}google.maps.event.trigger(this,"zindex_changed");};InfoBox.prototype.getContent=function(){return this.content_;};InfoBox.prototype.getPosition=function(){return this.position_;};InfoBox.prototype.getZIndex=function(){return this.zIndex_;};InfoBox.prototype.show=function(){this.isHidden_=false;this.div_.style.visibility="visible";};InfoBox.prototype.hide=function(){this.isHidden_=true;this.div_.style.visibility="hidden";};InfoBox.prototype.open=function(map,anchor){if(anchor){this.position_=anchor.getPosition();}this.setMap(map);if(this.div_){this.panBox_();}};InfoBox.prototype.close=function(){var self=this;if(this.closeListener_){google.maps.event.removeListener(this.closeListener_);this.closeListener_=null;}var pixPosition=this.getProjection().fromLatLngToDivPixel(this.position_);var newPos=(pixPosition.y+this.pixelOffset_.height-20)+"px";jQuery(this.div_).animate({opacity:0,top:newPos},200,function(){jQuery(self.div_).css({visibility:"hidden"});self.setMap(null);});};